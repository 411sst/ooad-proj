<mxfile host="app.diagrams.net" modified="2026-02-09" agent="Claude" version="24.0.0" type="device">
  <diagram id="d7_booking_lifecycle" name="State Diagram: Booking Lifecycle - Shrish">
    <mxGraphModel dx="1422" dy="762" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- ==================== TITLE ==================== -->
        <mxCell id="d7_title" value="State Diagram: Booking Lifecycle - Shrish" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=20;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="527" y="10" width="600" height="40" as="geometry"/>
        </mxCell>

        <!-- ==================== INITIAL STATE ==================== -->
        <mxCell id="d7_initial" value="" style="ellipse;html=1;aspect=fixed;fillColor=#000000;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="775" y="60" width="30" height="30" as="geometry"/>
        </mxCell>

        <!-- ==================== COMPOSITE STATE: ACTIVE ==================== -->
        <mxCell id="d7_composite_active" value="Active" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;fillColor=#f5f5f5;strokeColor=#666666;dashed=1;dashPattern=8 4;verticalAlign=top;fontStyle=1;fontSize=14;spacingTop=5;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="600" y="110" width="400" height="680" as="geometry"/>
        </mxCell>

        <!-- ==================== STATE 1: PENDING ==================== -->
        <mxCell id="d7_state_pending" value="Pending" style="swimlane;fontStyle=1;align=center;startSize=28;html=1;collapsible=0;rounded=1;arcSize=20;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="660" y="150" width="260" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="d7_state_pending_internal" value="entry / Create booking record&#xa;do / Wait for seat selection&#xa;exit / Prepare for seat locking" style="text;align=left;verticalAlign=top;spacingLeft=6;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;html=1;fontSize=10;fontColor=#333333;" vertex="1" parent="d7_state_pending">
          <mxGeometry y="28" width="260" height="92" as="geometry"/>
        </mxCell>

        <!-- ==================== STATE 2: LOCKED ==================== -->
        <mxCell id="d7_state_locked" value="Locked" style="swimlane;fontStyle=1;align=center;startSize=28;html=1;collapsible=0;rounded=1;arcSize=20;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="660" y="370" width="260" height="130" as="geometry"/>
        </mxCell>
        <mxCell id="d7_state_locked_internal" value="entry / Start 10-minute timer&#xa;do / Monitor timer countdown&#xa;exit / Clear timer" style="text;align=left;verticalAlign=top;spacingLeft=6;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;html=1;fontSize=10;fontColor=#333333;" vertex="1" parent="d7_state_locked">
          <mxGeometry y="28" width="260" height="102" as="geometry"/>
        </mxCell>

        <!-- ==================== STATE 3: CONFIRMED ==================== -->
        <mxCell id="d7_state_confirmed" value="Confirmed" style="swimlane;fontStyle=1;align=center;startSize=28;html=1;collapsible=0;rounded=1;arcSize=20;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="660" y="610" width="260" height="130" as="geometry"/>
        </mxCell>
        <mxCell id="d7_state_confirmed_internal" value="entry / Generate QR code&#xa;entry / Send confirmation email&#xa;entry / Mark seats as permanently booked" style="text;align=left;verticalAlign=top;spacingLeft=6;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;html=1;fontSize=10;fontColor=#333333;" vertex="1" parent="d7_state_confirmed">
          <mxGeometry y="28" width="260" height="102" as="geometry"/>
        </mxCell>

        <!-- ==================== COMPOSITE STATE: TERMINAL ==================== -->
        <mxCell id="d7_composite_terminal" value="Terminal" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;fillColor=#f5f5f5;strokeColor=#666666;dashed=1;dashPattern=8 4;verticalAlign=top;fontStyle=1;fontSize=14;spacingTop=5;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="120" y="420" width="370" height="430" as="geometry"/>
        </mxCell>

        <!-- ==================== STATE 4: CANCELLED ==================== -->
        <mxCell id="d7_state_cancelled" value="Cancelled" style="swimlane;fontStyle=1;align=center;startSize=28;html=1;collapsible=0;rounded=1;arcSize=20;fillColor=#f8cecc;strokeColor=#b85450;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="190" y="470" width="260" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="d7_state_cancelled_internal" value="entry / Calculate refund amount&#xa;entry / Release seats back to pool&#xa;entry / Send cancellation email" style="text;align=left;verticalAlign=top;spacingLeft=6;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;html=1;fontSize=10;fontColor=#333333;" vertex="1" parent="d7_state_cancelled">
          <mxGeometry y="28" width="260" height="92" as="geometry"/>
        </mxCell>

        <!-- ==================== STATE 5: REFUNDED ==================== -->
        <mxCell id="d7_state_refunded" value="Refunded" style="swimlane;fontStyle=1;align=center;startSize=28;html=1;collapsible=0;rounded=1;arcSize=20;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="190" y="730" width="260" height="100" as="geometry"/>
        </mxCell>
        <mxCell id="d7_state_refunded_internal" value="entry / Initiate refund transaction&#xa;entry / Send refund confirmation email" style="text;align=left;verticalAlign=top;spacingLeft=6;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;html=1;fontSize=10;fontColor=#333333;" vertex="1" parent="d7_state_refunded">
          <mxGeometry y="28" width="260" height="72" as="geometry"/>
        </mxCell>

        <!-- ==================== CHOICE PSEUDOSTATE ==================== -->
        <mxCell id="d7_choice" value="[refund?]" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="285" y="630" width="70" height="60" as="geometry"/>
        </mxCell>

        <!-- ==================== FINAL STATES ==================== -->
        <!-- Final state 1: bottom center -->
        <mxCell id="d7_final1" value="" style="ellipse;html=1;aspect=fixed;fillColor=#000000;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="788" y="830" width="24" height="24" as="geometry"/>
        </mxCell>
        <mxCell id="d7_final1_ring" value="" style="ellipse;html=1;aspect=fixed;fillColor=none;strokeColor=#000000;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="783" y="825" width="34" height="34" as="geometry"/>
        </mxCell>

        <!-- Final state 2: near cancelled path -->
        <mxCell id="d7_final2" value="" style="ellipse;html=1;aspect=fixed;fillColor=#000000;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="308" y="890" width="24" height="24" as="geometry"/>
        </mxCell>
        <mxCell id="d7_final2_ring" value="" style="ellipse;html=1;aspect=fixed;fillColor=none;strokeColor=#000000;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="303" y="885" width="34" height="34" as="geometry"/>
        </mxCell>

        <!-- ==================== TRANSITIONS ==================== -->

        <!-- T1: Initial → Pending -->
        <mxCell id="d7_trans_1" value="User selects seats" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;fontSize=10;fontStyle=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="d7_initial" target="d7_state_pending" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- T2: Pending → Locked -->
        <mxCell id="d7_trans_2" value="Seats locked /&#xa;Lock seats for 10 minutes" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;fontSize=10;fontStyle=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="d7_state_pending" target="d7_state_locked" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- T3: Pending → Cancelled -->
        <mxCell id="d7_trans_3" value="User abandons /&#xa;Release temporary locks" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;fontSize=10;fontStyle=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="d7_state_pending" target="d7_state_cancelled" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="620" y="210"/>
              <mxPoint x="620" y="400"/>
              <mxPoint x="500" y="400"/>
              <mxPoint x="500" y="500"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- T4: Locked → Confirmed -->
        <mxCell id="d7_trans_4" value="Payment successful /&#xa;Mark seats booked, send email, generate QR" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;fontSize=10;fontStyle=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="d7_state_locked" target="d7_state_confirmed" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- T5: Locked → Pending (Lock expires) -->
        <mxCell id="d7_trans_5" value="Lock expires (10 min) /&#xa;Release locks, broadcast availability" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;fontSize=10;fontStyle=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="d7_state_locked" target="d7_state_pending" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="980" y="435"/>
              <mxPoint x="980" y="210"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- T6: Locked → Cancelled -->
        <mxCell id="d7_trans_6" value="User cancels /&#xa;Release seat locks" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;fontSize=10;fontStyle=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="d7_state_locked" target="d7_state_cancelled" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="560" y="435"/>
              <mxPoint x="560" y="560"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- T7: Confirmed → Cancelled -->
        <mxCell id="d7_trans_7" value="[showtime &gt; 24h away]&#xa;User cancels booking" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;fontSize=10;fontStyle=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="d7_state_confirmed" target="d7_state_cancelled" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="640" y="675"/>
              <mxPoint x="640" y="650"/>
              <mxPoint x="320" y="650"/>
              <mxPoint x="320" y="590"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- T8: Confirmed → Final1 -->
        <mxCell id="d7_trans_8" value="Show completed /&#xa;Archive booking" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;fontSize=10;fontStyle=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="d7_state_confirmed" target="d7_final1_ring" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- T9: Cancelled → Choice -->
        <mxCell id="d7_trans_9" value="Process refund?" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;fontSize=10;fontStyle=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="d7_state_cancelled" target="d7_choice" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- T10: Choice → Refunded -->
        <mxCell id="d7_trans_10" value="[eligible for refund]" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;fontSize=10;fontStyle=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="d7_choice" target="d7_state_refunded" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- T11: Choice → Final2 -->
        <mxCell id="d7_trans_11" value="[not eligible]" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;fontSize=10;fontStyle=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="d7_choice" target="d7_final2_ring" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="160" y="660"/>
              <mxPoint x="160" y="902"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- T12: Refunded → Final2 -->
        <mxCell id="d7_trans_12" value="Refund processed /&#xa;Archive with refund details" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;fontSize=10;fontStyle=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#333333;" edge="1" source="d7_state_refunded" target="d7_final2_ring" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ==================== NOTES ==================== -->
        <mxCell id="d7_note1" value="State Pattern: each state is a&#xa;separate class (PendingState,&#xa;LockedState, ConfirmedState,&#xa;CancelledState, RefundedState)" style="shape=note;whiteSpace=wrap;html=1;size=14;fillColor=#ffffcc;strokeColor=#d6b656;fontSize=10;shadow=1;align=left;spacingLeft=6;" vertex="1" parent="1">
          <mxGeometry x="1060" y="140" width="220" height="80" as="geometry"/>
        </mxCell>

        <mxCell id="d7_note2" value="Observer Pattern notifies all&#xa;users when lock expires and&#xa;seats become available again" style="shape=note;whiteSpace=wrap;html=1;size=14;fillColor=#ffffcc;strokeColor=#d6b656;fontSize=10;shadow=1;align=left;spacingLeft=6;" vertex="1" parent="1">
          <mxGeometry x="1060" y="370" width="220" height="70" as="geometry"/>
        </mxCell>

        <mxCell id="d7_note3" value="Refund Guard Conditions:&#xa;[showtime &gt; 24h] = full refund&#xa;[6h &lt; showtime &lt; 24h] = partial refund&#xa;[showtime &lt; 6h] = no refund" style="shape=note;whiteSpace=wrap;html=1;size=14;fillColor=#ffffcc;strokeColor=#d6b656;fontSize=10;shadow=1;align=left;spacingLeft=6;" vertex="1" parent="1">
          <mxGeometry x="1060" y="580" width="230" height="80" as="geometry"/>
        </mxCell>

        <!-- Dashed connector from note1 to Pending -->
        <mxCell id="d7_note1_conn" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;dashed=1;strokeColor=#d6b656;strokeWidth=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;" edge="1" source="d7_note1" target="d7_state_pending" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Dashed connector from note2 to Locked -->
        <mxCell id="d7_note2_conn" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;dashed=1;strokeColor=#d6b656;strokeWidth=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="d7_note2" target="d7_state_locked" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Dashed connector from note3 to Choice -->
        <mxCell id="d7_note3_conn" style="edgeStyle=orthogonalEdgeStyle;html=1;rounded=1;dashed=1;strokeColor=#d6b656;strokeWidth=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" source="d7_note3" target="d7_choice" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ==================== LEGEND ==================== -->
        <mxCell id="d7_legend_box" value="Legend" style="rounded=1;whiteSpace=wrap;html=1;arcSize=10;fillColor=#f5f5f5;strokeColor=#999999;verticalAlign=top;fontStyle=1;fontSize=11;spacingTop=5;align=center;" vertex="1" parent="1">
          <mxGeometry x="1100" y="780" width="200" height="160" as="geometry"/>
        </mxCell>
        <mxCell id="d7_legend_init" value="" style="ellipse;html=1;aspect=fixed;fillColor=#000000;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="1115" y="815" width="16" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="d7_legend_init_label" value="Initial State" style="text;html=1;align=left;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="1140" y="810" width="100" height="24" as="geometry"/>
        </mxCell>
        <mxCell id="d7_legend_final_inner" value="" style="ellipse;html=1;aspect=fixed;fillColor=#000000;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="1117" y="847" width="12" height="12" as="geometry"/>
        </mxCell>
        <mxCell id="d7_legend_final_outer" value="" style="ellipse;html=1;aspect=fixed;fillColor=none;strokeColor=#000000;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1113" y="843" width="20" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="d7_legend_final_label" value="Final State" style="text;html=1;align=left;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="1140" y="840" width="100" height="24" as="geometry"/>
        </mxCell>
        <mxCell id="d7_legend_choice_sym" value="" style="rhombus;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1113" y="873" width="20" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="d7_legend_choice_label" value="Choice Pseudostate" style="text;html=1;align=left;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="1140" y="870" width="130" height="24" as="geometry"/>
        </mxCell>
        <mxCell id="d7_legend_state_sym" value="" style="rounded=1;html=1;arcSize=20;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="1110" y="903" width="26" height="16" as="geometry"/>
        </mxCell>
        <mxCell id="d7_legend_state_label" value="State with activities" style="text;html=1;align=left;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="1140" y="898" width="130" height="24" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
